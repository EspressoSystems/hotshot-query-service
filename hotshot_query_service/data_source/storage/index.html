<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Persistent storage for data sources."><title>hotshot_query_service::data_source::storage - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="hotshot_query_service" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0 (f6e511eec 2024-10-15)" data-channel="1.82.0" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../hotshot_query_service/index.html">hotshot_<wbr>query_<wbr>service</a><span class="version">0.1.62</span></h2></div><h2 class="location"><a href="#">Module storage</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#traits">Traits</a></li></ul></section><h2><a href="../index.html">In hotshot_<wbr>query_<wbr>service::<wbr>data_<wbr>source</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">hotshot_query_service</a>::<wbr><a href="../index.html">data_source</a>::<wbr><a class="mod" href="#">storage</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/hotshot_query_service/data_source/storage.rs.html#13-326">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Persistent storage for data sources.</p>
<p>Naturally, an archival query service such as this is heavily dependent on a persistent storage
implementation. This module defines the interfaces required of this storage. Any storage layer
implementing the appropriate interfaces can be used as the storage layer when constructing a
<a href="../fetching/struct.FetchingDataSource.html" title="struct hotshot_query_service::data_source::fetching::FetchingDataSource"><code>FetchingDataSource</code></a>, which can in turn be used to instantiate the
REST APIs provided by this crate.</p>
<p>This module also comes with a few pre-built persistence implementations:</p>
<ul>
<li><a href="sql/struct.SqlStorage.html" title="struct hotshot_query_service::data_source::storage::sql::SqlStorage"><code>SqlStorage</code></a></li>
<li><a href="fs/struct.FileSystemStorage.html" title="struct hotshot_query_service::data_source::storage::fs::FileSystemStorage"><code>FileSystemStorage</code></a></li>
<li><a href="no_storage/struct.NoStorage.html" title="struct hotshot_query_service::data_source::storage::no_storage::NoStorage"><code>NoStorage</code></a></li>
</ul>
<h2 id="storage-traits-vs-data-source-traits"><a class="doc-anchor" href="#storage-traits-vs-data-source-traits">§</a>Storage Traits vs Data Source Traits</h2>
<p>Many of the traits defined in this module (e.g. <a href="trait.NodeStorage.html" title="trait hotshot_query_service::data_source::storage::NodeStorage"><code>NodeStorage</code></a>, <a href="trait.ExplorerStorage.html" title="trait hotshot_query_service::data_source::storage::ExplorerStorage"><code>ExplorerStorage</code></a>, and
others) are nearly identical to the corresponding data source traits (e.g.
<a href="../../node/trait.NodeDataSource.html" title="trait hotshot_query_service::node::NodeDataSource"><code>NodeDataSource</code></a>,
<a href="../../explorer/trait.ExplorerDataSource.html" title="trait hotshot_query_service::explorer::ExplorerDataSource"><code>ExplorerDataSource</code></a>, etc). They typically differ in
mutability: the storage traits are intended to be implemented on storage
<a href="../trait.Transaction.html" title="trait hotshot_query_service::data_source::Transaction">transactions</a>, and because even reading may update the internal
state of a transaction, such as a buffer or database cursor, these traits typically take <code>&amp;mut self</code>. This is not a barrier for concurrency since there may be many transactions open
simultaneously from a single data source. The data source traits, meanwhile, are implemented on
the data source itself. Internally, they usually open a fresh transaction and do all their work
on the transaction, not modifying the data source itself, so they take <code>&amp;self</code>.</p>
<p>For traits that differ <em>only</em> in the mutability of the <code>self</code> parameter, it is almost possible
to combine them into a single trait whose methods take <code>self</code> by value, and implementing said
traits for the reference types <code>&amp;SomeDataSource</code> and <code>&amp;mut SomeDataSourceTransaction</code>. There are
two problems with this approach, which lead us to prefer the slight redundance of having
separate versions of the traits with mutable and immutable methods:</p>
<ul>
<li>The trait bounds quickly get out of hand, since we now have trait bounds not only on the type
itself, but also on references to that type, and the reference also requires the introduction
of an additional lifetime parameter.</li>
<li>We run into a longstanding <a href="https://github.com/rust-lang/rust/issues/85063"><code>rustc</code> bug</a> in
which type inference diverges when given trait bounds on reference types, even when
theoretically the types are uniquely inferrable. This issue can be worked around by <a href="https://users.rust-lang.org/t/type-recursion-when-trait-bound-is-added-on-reference-type/74525/2">explicitly
specifying type paramters at every call site</a>,
but this further exacerbates the ergonomic issues with this approach, past the point of
viability.</li>
</ul>
<p>Occasionally, there may be further differences between the data source traits and corresponding
storage traits. For example, <a href="trait.AvailabilityStorage.html" title="trait hotshot_query_service::data_source::storage::AvailabilityStorage"><code>AvailabilityStorage</code></a> also differs from
<a href="../../availability/trait.AvailabilityDataSource.html" title="trait hotshot_query_service::availability::AvailabilityDataSource"><code>AvailabilityDataSource</code></a> in fallibility.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.FailStorage"><code>pub use fail_storage::<a class="struct" href="fail_storage/struct.FailStorage.html" title="struct hotshot_query_service::data_source::storage::fail_storage::FailStorage">FailStorage</a>;</code></div></li><li><div class="item-name" id="reexport.FileSystemStorage"><code>pub use fs::<a class="struct" href="fs/struct.FileSystemStorage.html" title="struct hotshot_query_service::data_source::storage::fs::FileSystemStorage">FileSystemStorage</a>;</code></div></li><li><div class="item-name" id="reexport.NoStorage"><code>pub use no_storage::<a class="struct" href="no_storage/struct.NoStorage.html" title="struct hotshot_query_service::data_source::storage::no_storage::NoStorage">NoStorage</a>;</code></div></li><li><div class="item-name" id="reexport.SqlStorage"><code>pub use sql::<a class="struct" href="sql/struct.SqlStorage.html" title="struct hotshot_query_service::data_source::storage::sql::SqlStorage">SqlStorage</a>;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="fail_storage/index.html" title="mod hotshot_query_service::data_source::storage::fail_storage">fail_<wbr>storage</a></div></li><li><div class="item-name"><a class="mod" href="fs/index.html" title="mod hotshot_query_service::data_source::storage::fs">fs</a></div></li><li><div class="item-name"><a class="mod" href="no_storage/index.html" title="mod hotshot_query_service::data_source::storage::no_storage">no_<wbr>storage</a></div></li><li><div class="item-name"><a class="mod" href="pruning/index.html" title="mod hotshot_query_service::data_source::storage::pruning">pruning</a></div></li><li><div class="item-name"><a class="mod" href="sql/index.html" title="mod hotshot_query_service::data_source::storage::sql">sql</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.AggregatesStorage.html" title="trait hotshot_query_service::data_source::storage::AggregatesStorage">Aggregates<wbr>Storage</a></div></li><li><div class="item-name"><a class="trait" href="trait.AvailabilityStorage.html" title="trait hotshot_query_service::data_source::storage::AvailabilityStorage">Availability<wbr>Storage</a></div><div class="desc docblock-short">Persistent storage for a HotShot blockchain.</div></li><li><div class="item-name"><a class="trait" href="trait.ExplorerStorage.html" title="trait hotshot_query_service::data_source::storage::ExplorerStorage">Explorer<wbr>Storage</a></div><div class="desc docblock-short">An interface for querying Data and Statistics from the HotShot Blockchain.</div></li><li><div class="item-name"><a class="trait" href="trait.MerklizedStateHeightStorage.html" title="trait hotshot_query_service::data_source::storage::MerklizedStateHeightStorage">Merklized<wbr>State<wbr>Height<wbr>Storage</a></div></li><li><div class="item-name"><a class="trait" href="trait.MerklizedStateStorage.html" title="trait hotshot_query_service::data_source::storage::MerklizedStateStorage">Merklized<wbr>State<wbr>Storage</a></div><div class="desc docblock-short">This trait defines methods that a data source should implement
It enables retrieval of the membership path for a leaf node, which can be used to reconstruct the Merkle tree state.</div></li><li><div class="item-name"><a class="trait" href="trait.NodeStorage.html" title="trait hotshot_query_service::data_source::storage::NodeStorage">Node<wbr>Storage</a></div></li><li><div class="item-name"><a class="trait" href="trait.UpdateAggregatesStorage.html" title="trait hotshot_query_service::data_source::storage::UpdateAggregatesStorage">Update<wbr>Aggregates<wbr>Storage</a></div></li><li><div class="item-name"><a class="trait" href="trait.UpdateAvailabilityStorage.html" title="trait hotshot_query_service::data_source::storage::UpdateAvailabilityStorage">Update<wbr>Availability<wbr>Storage</a></div></li></ul></section></div></main></body></html>